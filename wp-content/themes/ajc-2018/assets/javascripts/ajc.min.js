function AJC_Product(t){t=t||{};var e=(window.jQuery,this),i=t.alternativeImageSrc||"";AJC.modals=AJC.modals||new AJC_Modals,this.name=t.name||"name",this.id=t.id||0,this.permalink=t.permalink||"",this.imageSrc=ko.observable(t.imageSrc||""),this.price=t.price||"",this.ollysPick=t.ollysPick||!1,this.status=t.status||"available",this.favcount=ko.observable(t.favcount||0),this.show=ko.observable(!0),this.dateAdded=ko.observable(t.dateAdded||""),this.favourite=ko.observable(t.favourite),this.favouriteButton=new AJC_FavouriteButton(this.id,this.favourite,this),this.link=function(){return'<a href="'+e.permalink+'">'+e.name+"</a>"},this.getPrice=function(){return"sold"==e.status?"Sold":"on_hold"==e.status?"On Hold":e.price},this.getStatus=function(){return e.status},this.quickView=function(){return AJC.modals.showModal("product",{product:this.id}),!1};var o,r=!1;this.originalImage=function(){clearTimeout(r),o&&n(100)},this.altImage=function(){o||n(100)};var n=function(t){var n=e.imageSrc();r=setTimeout(function(){e.imageSrc(i),i=n,o=!o},t)}}function inArray(t,e){for(var i=e.length,o=0;i>o;o++)if(e[o]==t)return!0;return!1}jQuery(document).ready(function(){AJC=AJC||{},jQuery("form.woocommerce-ordering select").on("change",function(){jQuery(this).parents("form").trigger("submit")})}),jQuery(document).ready(function(t){if(AJC=AJC||{},function(){if(t(".main-shop").length)return AJC.view=new DynamicView,AJC.view.getProducts(),void ko.applyBindings(AJC.view);if(t(".favourites-summary").length)return AJC.view=new FavouriteProductsView,void ko.applyBindings(AJC.view);if(t(".term-tabset").length){var e=t(".term-tabset");return void ko.applyBindings(new AJC_TermTabs(e))}return t(".recommended-products").length?(AJC.view=new AJC_ProductsView,AJC.genericProducts.products&&AJC.view.addProducts(AJC.genericProducts.products),AJC.view.favouriteAll=function(){ko.utils.arrayMap(this.products(),function(t){t.favouriteButton.makeFavourite()})},void ko.applyBindings(AJC.view)):t(".page-jewellery").length?(AJC.view={dropdown:new AJCDropdown},void ko.applyBindings(AJC.view)):void 0}(),t("#ajc_signup_form").length&&(AJC_SignupForm.init(),ko.applyBindings(AJC_SignupForm,document.getElementById("ajc_signup"))),t(".ajc_survey_form").length&&(window.AJC_SurveyForm=new AJC_SurveyForm,window.AJC_SurveyForm.init(),ko.applyBindings(AJC_SurveyForm,document.getElementById("ajc_survey_form"))),t(".sequence").length&&(window.signup=new AJC_SignupSequence(t(".sequence"))),t("#trackable").length){var e=t("#trackable .order-tracking").get();t(e).each(function(e,i){ko.applyBindings(new AJC_Tracking(t(i).data("id")),i)})}var i=function(e,i){AJC_SignupForm.connectedToFB(!0),AJC_SignupForm.avatar("http://graph.facebook.com/"+i.username+"/picture?width=200&height=200"),AJC_SignupForm.at_fb_id(e.authResponse.userID),AJC_SignupForm.at_fb_token(e.authResponse.accessToken),AJC_SignupForm.first_name(i.first_name),AJC_SignupForm.last_name(i.last_name),AJC_SignupForm.email(i.email),t("#manual_signup").hide(),AJC_SignupForm.show()};t(document).on("ArchetypeFB_Signup",function(t,e,o){i(e,o),AJC_SignupForm.show()}),t(document).on("ArchetypeFB_Login",function(t,e){return e.newUser?(window.location="/signup?failed_login=true",!1):void(window.location="/")}),t(document).on("ArchetypeFB_AJAXstart",function(e,i){t(i).append(t("<span>").addClass("icon-refresh icon-spin space-left")),t(i).addClass("loading")}),t(document).on("ArchetypeFB_AJAXstop",function(e,i){t(i).text("Connected to Facebook").parent().addClass("connected-text connected"),t(i).append(t("<span>").addClass("ion-checkmark space-left")),t(i).removeClass("loading"),t(".icon-refresh .icon-spin").remove()}),t("#loginform #user_login").attr("placeholder","Username"),t("#loginform #user_pass").attr("placeholder","Password"),t("#price-search-slider").slider({range:!0,min:0,step:500,max:5e3,slide:function(e,i){t("#price-low").text("Â£"+i.values[0]),t("#price-high").text("Â£"+i.values[1])},values:[0,5e3],change:function(e,i){t("input[name=_priceLow]").val(i.values[0]),t("input[name=_priceHigh]").val(i.values[1])}}),function(t){if(0!=t("#back_to_top").length){var e=!1,i=t("#back_to_top"),o=t(document.body).children(0).position().top;i.hide(),t(window).scroll(function(){t(window).scrollTop()<=o?(e=!1,i.fadeOut(300)):0==e&&(e=!0,i.stop(!0,!0).fadeIn(300))}),t("#back_to_top").click(function(e){e.preventDefault(),t("html, body").animate({scrollTop:0},500)})}}(jQuery)});var AJC_Modals=function(){var t=window.jQuery;this.modals={},this.showModal=function(e,i,o){var r=e+JSON.stringify(i),o=t.extend({callback:function(){},autoClose:!1},o);o.autoClose&&(o.onOpen=function(e){e.overlay.show(),e.container.show(),e.data.show(),window.setTimeout(function(){e.container.fadeOut(100,function(){e.overlay.fadeOut(100,function(){t.modal.close()})})},100)});var n=this.modals[r],s=this;return void 0===n?void s.fetchModal(e,i,r,o):void 0}},AJC_Modal=function(t){this.isSetup=!1,this.markup=t.markup,this._type=t._type},productGallery=function(t){var e,i=window.jQuery,o=i(t).find(".product-images"),r=this,n=o.data("gallery-setup")||!1;this.isNeeded=function(){return o&&!n},this.selectImage=function(t){var o=i(t).attr("href"),r=i(t).attr("original-href");e.attr("src",o),e.parent().attr("href",r)},this.init=function(){o.find(".zoom").click(function(){return r.selectImage(this),!1}),n=!0,o.data("gallery-setup",n),e=o.find(".wp-post-image")}};AJC.spinner=new Spinner({lines:11,length:3,width:3,radius:7,corners:1,rotate:0,direction:1,color:"#999",speed:2,trail:100,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9,top:"0",left:"0"}),AJC.showSpinner=function(t){t=t||"initial-spinner",el=document.getElementById(t),this.spinElement=el,jQuery(el).addClass("spinning"),AJC.spinner.spin(el)},AJC.hideSpinner=function(){jQuery(this.spinElement).removeClass("spinning"),AJC.spinner.stop()};var fieldFilterMapping={create:function(t){return ko.observableArray(t.data)}},AJCDropdown=function(){var t=this,e=window.jQuery;this.open=ko.observable(),this.showChildren=function(i,o){var r=e(o.target),n=(r.siblings(".sub-menu"),e(o.target).siblings(".sub-menu").slideToggle("fast").promise());return n.done(function(e){t.open(e.is(":visible")?!0:!1)}),!1},this.DOMinit=function(t){this.open(e(t).data("current"))}},AJC_ProductsView=function(){this.products=ko.observableArray([]),this.ready=ko.observable(!1);var t=0;this.showProduct=function(e){1===e.nodeType&&(jQuery(e).hide(),setTimeout(function(){jQuery(e).fadeIn(300)},t+=75))},this.hideProduct=function(t){jQuery(t).remove()},this.ready.subscribe(function(){t=0})};AJC_ProductsView.prototype=jQuery.extend(AJC_ProductsView.prototype,{addProducts:function(t){this.products(_.map(t,function(t){return new AJC_Product(t)}))}});var FavouriteProductsView=function(){var t=window.jQuery,e=this,i=function(i){t(i).on("favourite-added",function(t,o){e.primaryProductsView.products.push(i),o.favourite(!0)}),t(i).on("favourite-removed",function(t,o){e.primaryProductsView.products.remove(i),o.favourite(!1)})};AJC.relatedProducts.products&&(this.relatedProductsView=new AJC_ProductsView,this.relatedProductsView.products(_.map(AJC.relatedProducts.products,function(t){var e=new AJC_Product(t);return i(e),e}))),AJC.favouriteProducts.products&&(this.primaryProductsView=new AJC_ProductsView,this.primaryProductsView.products(_.map(AJC.favouriteProducts.products,function(t){var e=new AJC_Product(t);return i(e),e})))},DynamicView=function(){AJC_ProductsView.call(this);var t=window.jQuery,e=this,i=(t(".content"),window.location.protocol+"//"+window.location.host+window.location.pathname),o=0,r=5e3;this.dropdown=new AJCDropdown;var n=function(){var t=a();return result=i+t,result},s=function(){var t=e.selectedSortOption();return t?t.value:void 0},a=function(){var t=document.location.href,i=u(t),n="?";(e.priceLow()!==o||e.priceHigh()!==r)&&(n+="_priceLow="+e.priceLow(),n+="&_priceHigh="+e.priceHigh()+"&");for(filter in e.publicFilters())filter=e.publicFilters()[filter],n+="_"+filter.name+"="+filter.value.join(",")+"&";return n+=i+"&",n.slice(0,-1)},u=function(t){var e,i=t.search("&post_type=product");if(-1==i)e="";else{var o=t.indexOf("?s=");if(-1==o){var r=t.indexOf("&s=");r+=1,e=t.substr(r)}else o+=1,e=t.substr(o)}return e};this.search=AJC.search||0,this.publicFilters=ko.observableArray([]),this.foundProducts=ko.observable(),this.products=ko.observableArray([]),this.noMoreProducts=ko.observable(!1),this.selectedSortOption=ko.observable(),ko.mapping.fromJS({_filters:AJC.filter},fieldFilterMapping,e),this._filters.ajc_p_status=ko.observableArray(AJC.productStatus?[AJC.productStatus]:[]),this._filters.collection=ko.observableArray([]),this.scrollInit=!1,this.gettingMore=ko.observable(!1),this.priceLow=ko.observable(AJC.priceRange[0]),this.priceHigh=ko.observable(AJC.priceRange[1]),this.sortOptions=ko.observableArray([{value:"",name:"Date Added"},{value:"_price-high",name:"Price, High to Low"},{value:"_price-low",name:"Price, Low to High"},{value:"_favourited-high",name:"Most Favourited"},{value:"_views-high",name:"Most Viewed"}]),this.priceHighText=function(){var t=this.priceHigh();return t?5e3===t?"5000+":t:!1},t(document).ready(function(){t("#slider-range").slider({range:!0,min:o,step:500,animate:!1,max:r,slide:function(e,i){t("#price-low").text("Â£"+i.values[0]),t("#price-high").text("Â£"+i.values[1])},values:[e.priceLow(),e.priceHigh()],change:function(t,i){e.priceLow(i.values[0]),e.priceHigh(i.values[1]),l()}});var i=t("#sort-option-selected"),n=t("#sort-options .dropdown-inner");_.map(e.sortOptions(),function(t){n.append("<li data-option='"+t.value+"'>"+t.name+"</li>")}),n.find("li").click(function(){e.selectedSortOption({value:t(this).data("option")}),i.text(t(this).text())})});var c=function(){return a().length>0};if(this.allTitle=function(){return c()?"Search Results":"All"},this.foundProductsString=function(){var t=e.foundProducts();return t>1?t+" items found":1>t?"":(t=1)?"1 item found":void 0},!e.products().length&&"undefined"!=typeof AJC.serverProducts){if(e.serverProducts=!0,e.addProducts(AJC.serverProducts.products),AJC.serverProductsOptions)for(var d in AJC.serverProductsOptions)e._filters[d].push(AJC.serverProductsOptions[d]);e.foundProducts(parseInt(AJC.serverProducts.foundProducts))}this.filterChange=ko.computed(function(){for(var t in e._filters){var i=e._filters[t];ko.isObservable(i)&&i()}});var l=function(){h(),e.getProducts(),e.updatePublicFilterList(),e.updateURL(),location.reload()};this.filterChange.subscribe(l),this.selectedSortOption.subscribe(l),this.removeFilter=function(t,i){e._filters[t].remove(i)},this.filtersToShow=function(){return e.search||e.publicFilters().length};var p=function(){return{filter:e._filters,price_low:e.priceLow(),price_high:e.priceHigh(),search:e.search,archive:AJC.archive,sort:s(),collection:function(){var t=new RegExp("/collection/([^/]+)/?"),e=window.location.toString(),i=e.match(t);return i&&i[1]?i[1]:void 0},ollys_picks:function(){var t=new RegExp("/ollys-picks/([^/]+)/?"),e=window.location.toString(),i=e.match(t);return i&&i[1]?i[1]:void 0},period:function(){var t=new RegExp("/period/([^/]+)/?"),e=window.location.toString(),i=e.match(t);return i&&i[1]?i[1]:void 0}()}};this.getPublicFilterNicename=function(e){return t('label[for="'+e+'"]').text()},this.updatePublicFilterList=function(){e.publicFilters([]);var t;for(var i in e._filters)"type"!==i&&(t=e._filters[i](),t.length&&e.publicFilters.push({name:i,value:t}))},this.clearSearch=function(){var t=n(),e=t.split("?"),i=e[0]+"shop/";return e[1]?i+"?"+e[1]:i},this.updateURL=function(){history.replaceState(null,null,n())},this.clearPublicFilters=function(){for(var t in e.publicFilters()){var i=e.publicFilters()[0].name;e._filters[i].removeAll()}},this.getProducts=function(){e.ready(!1),e.noMoreProducts(!1),Archetype.post("get_products",p(),function(t){e.init=!0,e.addProducts(t.products),e.ready(!0),e.noMoreProducts(e.products().length>=t.foundProducts?!0:!1),e.foundProducts(t.foundProducts)})},this.getMoreProducts=function(i){this.gettingMore(!0),Archetype.post("get_products",t.extend(p(),{offset:e.products().length}),function(t){e.gettingMore(!1);var o=_.map(t.products,function(t){return new AJC_Product(t)});(!o.length||e.products().length>=parseInt(t.foundProducts))&&e.noMoreProducts(!0),e.products(_.union(e.products(),o)),f(),i()})},jQuery(document).ready(function(){t(".lateral-link").click(function(){var e=t(this).attr("href");t(this).attr("href",e+a())})});var h=function(){t("#loading-more").waypoint("destroy"),t("#loading-more").remove(),e.scrollInit=!1},f=function(){if(t("#loading-more").length&&h(),e.noMoreProducts())return void t("_loader").fadeOut(function(e){t(e).remove()});var i='<div style="clear:both;" id="loading-more"></div>';t("._loader").append(i),t("#loading-more").waypoint(function(){e.getMoreProducts(function(){var e='<div style="clear:both;" id="loading-more"></div>';t("._loader").append(e)})},{offset:window.outerHeight+50}),e.scrollInit=!0};this.updatePublicFilterList()};DynamicView.prototype=Object.create(AJC_ProductsView.prototype);var AJC_SignupForm=new function(){var t,e=this;this.connectedToFB=ko.observable(!1),this.formHidden=ko.observable(!0),this.formHasErrors=ko.observable(!1),this.avatar=ko.observable(),this.show=function(){t.slideDown(),this.formHidden(!1)},this.formHasErrors.subscribe(function(t){t===!0&&e.show()}),this.init=function(){t=jQuery("#ajc_signup_form"),ko.utils.arrayMap(AJC.signup,function(i){var o=t.find("input[name="+i+"]"),r=o.val();e[i]=ko.observable(r),o.data("error")&&e.formHasErrors(!0)}),e.fullName=ko.computed(function(){return e.first_name()+" "+e.last_name()})}},AJC_FavouriteButton=function(t,e,i){var o=this,r=window.jQuery;this.favourite=e,this.favcount=i.favcount,this.id=t,this.toggle=function(){return Archetype.isUserLoggedIn()?void Archetype.post("toggle_favourite",{product_id:o.id},function(t){o.favcount(t.favcount),o.favourite(t.favourite),o.favourite()?(AJC.modals.showModal("added-favourite",{product:o.id},{autoClose:!0}),r(i).trigger("favourite-added",[i])):r(i).trigger("favourite-removed",[i])}):void AJC.modals.showModal("not-logged-in",{referer:i.permalink})},this.makeFavourite=function(){Archetype.post("toggle_favourite",{product_id:o.id,force:!0},function(t){o.favourite(t.favourite),o.favcount(t.favcount),o.favourite()?(AJC.modals.showModal("added-favourite",{product:o.id},{autoClose:!0}),r(i).trigger("favourite-added",[i])):r(i).trigger("favourite-removed",[i])})},this.favouriteTitle=ko.computed(function(){var t=o.favourite();return t?"Remove item from your favourites":"Add to your favourites"});var n;this.DOMInit=function(t){n||(this.favcount(r(t).data("_favcount")),this.favourite(r(t).data("_favourite")),n=!0)}},AJC_SurveyForm=function(){var t,e=(window.jQuery,this);this.init=function(){ko.utils.arrayMap(AJC.survey,function(t){e[t]=ko.observableArray([])}),t=jQuery("#ajc_survey_form"),e.pictureLIs=function(){obj={};for(var e in AJC.survey)obj[AJC.survey[e]]=ko.utils.arrayMap(t.find("li[data-group="+AJC.survey[e]+"]"),function(t){return new AJC_PictureLI(t)});return obj}(),e.values=ko.computed(function(){return function(){var t={};for(var i in AJC.survey)t[AJC.survey[i]]=e[AJC.survey[i]]();return t}()}),e.values.subscribe(function(t){for(var i in t){var o=t[i],r=e.pictureLIs[i];ko.utils.arrayForEach(r,function(t){t.setStatus(inArray(t.id,o))}),e[i].allSelected=!1}})},this.selectAll=function(t){if(e[t].allSelected===!0)return e.deselectAll(t),void(e[t].allSelected=!1);var i=[],o=e.pictureLIs[t];ko.utils.arrayForEach(o,function(t){i.push(t.id.toString())}),e[t](i),e[t].allSelected=!0},this.deselectAll=function(t){e[t]([])}},AJC_SignupSequence=function(t){var e=this,i=t.length;this.current=-1,this.steps=t,this.next=function(){e.current<i&&e.current++,e.refresh(e.current)},this.prev=function(){e.current>0&&e.current--,e.refresh(e.current)},this.refresh=function(t){jQuery(e.steps).hide(),jQuery(e.steps[t]).show()},this.getCurrentStep=function(){return e.steps[e.current]?e.steps[e.current]:void 0},this.init=function(t){t(e.steps).hide(),e.next()}(jQuery)},AJC_PictureLI=function(t){var e=this;this.el=jQuery(t),this.id=this.el.data("id"),this.group=this.el.data("group"),this.input=this.el.find("input"),this.setStatus=function(t){this.el.toggleClass("selected",t)},this.el.click(function(){return e.input.attr("checked",!e.input.attr("checked")),e.input.triggerHandler("click"),!1})},AJC_Tracking=function(t){return function(e,i){this.el=t(i),this.id=e;var o=this;this.lastCheckpointTime=ko.observable(!1),this.lastPosition=ko.observable(!1),this.status=ko.observable(!1),this.message=ko.observable(!1),this.error=ko.observable(!1),this.hasTrackingData=ko.observable(!1),this.noDataYet=ko.observable(!1),this.data=!1,this.getStatus=function(){Archetype.post("get_tracking_info",{order_id:o.id},function(t){if(1==t.status)if(o.data=new AfterShip_Status(t.data),o.hasTrackingData(!0),o.data.getLatestPosition()!==!1){var e=o.data.getLatestPosition();o.lastPosition(e.country_name),o.status(null===e.tag?!1:e.tag),o.message(e.message),o.lastCheckpointTime(new Date(e.checkpoint_time).toString())}else o.noDataYet(!0);else o.error("No tracking data is available at present")})}}}(jQuery),AfterShip_Status=function(t){var e=this;this.hash=t,this.getLatestPosition=function(){return e.hash.checkpoints.length?e.hash.checkpoints[e.hash.checkpoints.length-1]:!1}};!function(){function t(){return window.innerWidth<600?2:window.innerWidth<900?4:6}var e,i=window.jQuery,o=i(window);i(".flexslider")&&AJC.flexslider&&(o.load(function(){i(".flexslider.products-slider").flexslider({animation:"slide",animationSpeed:200,controlNav:!1,directionNav:!0,slideshow:!0,itemMargin:32,itemWidth:206,pauseOnHover:!0,move:6,randomize:!0,minItems:1,maxItems:8,start:function(){i(".products-slider li").show()}}),jQuery(".flexslider.main-slider").flexslider({randomize:!0,pauseOnHover:!0,controlNav:!1,directionNav:!1,slideshowSpeed:6e3,animationSpeed:800,slideshow:!0,start:function(t){t.removeClass("loading")}})}),o.resize(function(){var i=t();e&&(e.vars.minItems=i,e.vars.maxItems=i)}))}(),String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)},jQuery(".account .autocomplete").autocomplete({source:function(t,e){Archetype.post("ajc_search",{query:t},e)},select:function(t,e){window.location=e.item.url}}),jQuery(".autocomplete").autocomplete({source:function(t,e){Archetype.post("ajc_search",{query:t},e)},select:function(t,e){window.location=e.item.url}});var $=window.jQuery;$("#search-toggle").click(function(){return $(".search-toggle").toggle(),$(".nav-toggle").hide(),$(".ion-search").addClass("active"),!1}),$("#nav-toggle").click(function(){return $(".nav-toggle").toggle(),$(".search-toggle").hide(),$(".ion-navicon").addClass("active"),!1}),$(".toggle .close-toggle").click(function(){$(this).closest(".toggle").toggle()}),($=jQuery)(function(){jQuery("body").on("click","a.quick-view",function(t){t.preventDefault();var e=$("#product"),i=$("#product .modal-content"),o=pid1=$(this).data("id"),r=0;return e.on("show.bs.modal",function(){r||o==pid1&&($.ajax({type:"POST",url:_Archetype.ajaxurl,data:{action:"get_product_modal_html",pid:o},dataType:"html",success:function(t){i.html(t)}}),r=1)}).modal(),e.on("hidden.bs.modal",function(){e="",i.empty()}).modal(),!1})});